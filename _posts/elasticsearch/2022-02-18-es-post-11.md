---
title: "ES 검색엔진 만들기 (9) multifield search와 multifield search 검색 향상"
date: 2022-02-18-00:00:00 -0000
categories: ELASTICSEARCH
---

주소 검색 multifield match 를 사용하면 되잖아??

multifield search의 강점과 내가 이를 사용하지 못한 이유!!!에 대한 포스팅


### 들어가기 전에

일반적인 매치 쿼리는 단일 필드에서 검색을 위한 쿼리이다. 필드 매핑을 이해하고, 필드를 위한 적절한 analyzer를 선택할 수도 있다. 그리고 모든 워드를 매칭할수도 있다. 원한다면 or and match 그리고 minimum_should_match 등을 이용하여 매칭 워드의 비율을 조절하는것 또한 가능하다. 또한 fuzzy 매칭을 사용하여 근접한 워드에 대한 검색 또한 가능하다. (한글은 조금 다름) 다시 말해 __매치 쿼리는 굉장히 유연하고, 파워풀 하다__

다방면의 검색은 굉장히 까다롭고 선택하기 어렵다. 그리고 사람이 딱딱 필드를 지정해주는것이 아닌 상황의 일상 대화에서는 !!! 그렇기 떄문에 더욱 더 잘 알아야 하고 잘 써야 한다.

단순히 검색이 될만한 모든 필드를 지정하고 request 를 날리면 되는것이 아니라는말이다

### multi_match_query

엘라스틱에서 지원하는 multi_match query를 보자
```
{
  "multi_match": {
      "query":    "여기 서울시 마포구 서교동 GS25 인데요",
      "fields": [ "name", "sido", "sigun", "gu", "law_address_dong", "admin_address_dong", "road_address_name"]
  }
}
```

크으,,, 주소 검색엔진 개발 끝이다?? 여기다 각 필드의 analyzer를 지정해주면 토크나이징까지 해주니 완벽하다. 

현실은 그러하지 못하다. 보이는 예가 다가 아니다. 나는 multi_match query의 작동 법을 알고 있음에도 종종 이것들을 잘못 사용하고, 끔직한 결과를 불러올떄가 많다. 

일단은 이 muㅣti_match query의 올바른 사용법 부터 익힌후 검색엔진을 개선해 나아가 보도록 하자 



[Multi-Field Search Just Got Better](https://www.elastic.co/kr/blog/multi-field-search-just-got-better)