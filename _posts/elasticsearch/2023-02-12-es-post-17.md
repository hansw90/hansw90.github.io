---
title: "엘라스틱서치에서 score normalization"
date: 2023-02-11-00:00:00 -0000
categories: ELASTICSEARCH
---

이전에 스코어를 컨트롤하는 방법을 다뤄본적이 있다. 
하지만, 실제로 서비스를 만들다보면, 이것만으로는 충분하지 않을떄가 있다.
(문서 내의 단어의 빈도를 가지고 검색엔진의 점수를 컨트롤 하는건 생각보다 쉬운인일이 아니다..)

그럴떄 나는 점수를 정규화 하여 스코어를 사용할떄가 있는데, 이 정규화 방법에 대해 알아보자.

## 차례
1. function score 자세히 알아보기
2. script 자세히 알아보기
3. score nomalization
  - constant score
4. example


## 1. function score 자세히 알아보기

이번 테스트에선 아래와 같은 데이터를 사용한다.

```json
POST _bulk
{ "index" : { "_index" : "poi_example", "_id" : "1" } }
{ "target_poi_name" : "신당동 떡볶이", "target_dong_name": null, "like": 0}
{ "index" : { "_index" : "poi_example", "_id" : "2" } }
{ "target_poi_name" : "우체국", "target_dong_name": "신당동", "like": 0}
{ "index" : { "_index" : "poi_example", "_id" : "3" } }
{ "target_poi_name" : "휴먼시아", "target_dong_name": "신당동", "like": 0}
{ "index" : { "_index" : "poi_example", "_id" : "4" } }
{ "target_poi_name" : "떡볶이집", "target_dong_name": "신당동", "like": 0}
{ "index" : { "_index" : "poi_example", "_id" : "5" } }
{ "target_poi_name" : "신당동 떡볶이", "target_dong_name": "중앙동", "like": 0}
{ "index" : { "_index" : "poi_example", "_id" : "6" } }
{ "target_poi_name" : "우체국", "target_dong_name": "중앙동", "like": 0}
{ "index" : { "_index" : "poi_example", "_id" : "7" } }
{ "target_poi_name" : "신당역", "target_dong_name": "신당동", "like": 0}
{ "index" : { "_index" : "poi_example", "_id" : "8" } }
{ "target_poi_name" : "신당초등학교", "target_dong_name": "신당동", "like": 0}
{ "index" : { "_index" : "poi_example", "_id" : "10" } }
{ "target_poi_name" : "엽기 떡볶이", "target_dong_name": "신당동", "like": 0}

```

target_poi_name 필드에만 nori analyzer를 적용하였고, 나머진 그냥 타입 자동생성을한 필드이다.
(__id 1번__은 같이 다른 document와는 다르게 target_dong_name 값이 null인걸 기억하자.)

내가 하고 싶은 검색은 아래와 같다, 오늘 친구와 함께 떡볶이가 먹고 싶어, 대화를 나눈다.
